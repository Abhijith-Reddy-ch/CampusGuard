<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency SOS</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .sos-btn {
            background-color: #e74c3c;
            color: white;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: none;
            font-size: 2rem;
            font-weight: bold;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.6);
            cursor: pointer;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7);
            }

            70% {
                transform: scale(1.1);
                box-shadow: 0 0 0 20px rgba(231, 76, 60, 0);
            }

            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(231, 76, 60, 0);
            }
        }
    </style>
</head>

<body>
    <nav>
        <div class="brand">CampusGuard</div>
        <ul>
            <li><a href="../index.html">Home</a></li>
            <li><a href="register.html">Register</a></li>
            <li><a href="entry.html">Entry Log</a></li>
            <li><a href="exit.html">Exit Log</a></li>
            <li><a href="schedule.html">Schedule</a></li>
            <li><a href="teacher.html">Attendance</a></li>
            <li><a href="proctor.html">Security</a></li>
            <li><a href="admin.html">Admin</a></li>
        </ul>
    </nav>
    <div id="notification-area"></div>

    <main class="text-center"
        style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 60vh;">
        <h1>EMERGENCY - SOS</h1>
        <p>Press the button below to alert Security immediately.</p>

        <div class="form-group" style="margin: 2rem 0;">
            <label>Your Student ID (Optional)</label>
            <input type="text" id="studentId" placeholder="Enter ID" style="width: 200px; text-align: center;">
        </div>

        <button class="sos-btn" onclick="sendSOS()">SOS</button>

        <p id="statusMsg" style="margin-top: 2rem; font-weight: bold;"></p>
    </main>

    <script src="../js/main.js"></script>
    <script>
        function sendSOS() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    postAlert({
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    });
                }, error => {
                    // Fallback if location denied
                    postAlert({ lat: 0, lng: 0, error: "Location Denied" });
                });
            } else {
                postAlert({ lat: 0, lng: 0, error: "No Geo Support" });
            }
        }

        async function postAlert(location) {
            const btn = document.querySelector('.sos-btn');
            btn.disabled = true;
            btn.innerText = "SENDING...";

            const id = document.getElementById('studentId').value;
            const data = {
                studentId: id || "Unknown Student",
                location
            };

            const result = await apiCall('/api/sos', 'POST', data);

            if (result && result.success) {
                showNotification("SOS Sent! Help is on the way.", "success");
                document.getElementById('statusMsg').innerText = "SOS SIGNAL SENT. STAY CALM.";
                document.getElementById('statusMsg').style.color = "red";
            }
            btn.innerText = "SOS";
            btn.disabled = false;
        }
    </script>
</body>

</html>